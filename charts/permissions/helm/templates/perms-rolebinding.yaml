{{- range $permission := .Values.permissions }}
apiVersion: perms.infra-mgmt.io/v1beta1
kind: PermsRoleBinding
metadata:
  name: "{{$permission.name}}"
  labels:
    app.kubernetes.io/name: {{ $.Chart.Name }}
    helm.sh/chart: {{ $.Chart.Name }}-{{ $.Chart.Version | replace "+" "_" }}
    app.kubernetes.io/managed-by: {{ $.Release.Service}}
    app.kubernetes.io/instance: {{ $.Release.Name }}
    app.kubernetes.io/version: {{ $.Chart.AppVersion}}
spec:
  role: "{{$permission.role.name}}"
  kind: "{{$permission.role.kind}}"
  groups:
  {{- range $group := $permission.groups}}
    - {{$group}}
  {{- end }}
  user:
    {{- range $user := $permission.user}}
    - {{$user}}
  {{- end }}
  serviceaccounts:
  {{- range $sa := $permission.serviceaccounts}}
    - name: "{{$sa.name}}"
      namespace: "{{$sa.namespace}}"
  {{- end}}

{{- end }}